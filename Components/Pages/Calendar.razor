@page "/calendar"
@using MyJournal.Services

<div class="calendar-container">
    <div class="calendar-header">
        <h2 class="month-label">@displayDate.ToString("MMMM yyyy")</h2>
        <div class="nav-controls">
            <button class="nav-btn" @onclick="() => ChangeMonth(-1)">Previous</button>
            <button class="nav-btn" @onclick="() => ChangeMonth(1)">Next</button>
        </div>
    </div>

    <div class="calendar-grid">
        <div class="day-header">Sun</div>
        <div class="day-header">Mon</div>
        <div class="day-header">Tue</div>
        <div class="day-header">Wed</div>
        <div class="day-header">Thu</div>
        <div class="day-header">Fri</div>
        <div class="day-header">Sat</div>

        @foreach (var day in calendarDays)
        {
            @if (day == null)
            {
                <div class="day-cell empty"></div>
            }
            else
            {
                // Check dictionary for data
                var hasEntry = entryMap.TryGetValue(day.Value.Date, out var meta);
                var isToday = day.Value.Date == DateTime.Today;

                <div class="day-cell @(isToday ? "today" : "") @(hasEntry ? "clickable" : "")"
                     @onclick="() => OnDateClick(day)">

                    <span class="day-number">@day.Value.Day</span>

                    @if (hasEntry && meta != null)
                    {
                        <div class="mood-badge" title="@meta.Mood">
                            @MoodHelperService.GetEmojisPerMood(meta.Mood)
                        </div>
                    }
                </div>
            }
        }
    </div>
</div>