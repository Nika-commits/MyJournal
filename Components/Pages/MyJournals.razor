@page "/myJournals"
@using MyJournal.Components.Models
@using MyJournal.Components.Shared
@using MyJournal.Services

<div class="page-container">
    <div class="header-section">
        <h2>My Journals</h2>
        <a href="todaysJournal" class="btn-add">
            + New Entry
        </a>
    </div>
    <div class="filter-section">
        <div class="search-box">
            <input type="text" placeholder="Search..." @bind="searchTerm" @bind:event="oninput" @onkeyup="ExecuteSearch" />
        </div>

        <select class="filter-dropdown" @onchange="OnCategoryChanged">
            <option value="All">All Vibes</option>
            <option value="Positive">Positive</option>
            <option value="Neutral">Neutral</option>
            <option value="Negative">Negative</option>
        </select>

        <select class="filter-dropdown" @onchange="OnTagChanged">
            <option value="All">All Tags</option>
            @foreach (var tag in MoodHelperService.PredefinedTags)
            {
                <option value="@tag">@tag</option>
            }
        </select>
    </div>

    @if (JournalList == null || JournalList.Count == 0)
    {
        <div class="empty-state">
            <div class="empty-icon">📝</div>
            <h3>No entries yet</h3>
            <p>Your journal is waiting for your first story.</p>
            <a href="todaysJournal" class="btn-primary">Write Today's Entry Entry</a>
        </div>
    }
    else
    {
        <div class="journal-grid">
            @foreach (var entry in JournalList)
            {
                <div class="journal-card" @onclick="() => ViewEntry(entry.Id)">
                    <div class="card-top">
                        <span class="entry-date">@entry.EntryDate.ToString("MMM dd")</span>
                        <span class="mood-emoji" title="@entry.PrimaryMood">@MoodHelperService.GetEmoji(entry.PrimaryMood)</span>
                    </div>

                    <h3 class="entry-title">@entry.Title</h3>
                    <p class="entry-preview">
                        @* @(entry.Content?.Length > 100 ? entry.Content.Substring(0, 100) + "..." : entry.Content) *@
                        @((MarkupString)GetPreview(entry.Content))
                    </p>

                    <div class="card-footer">
                        <span class="tags">@entry.Tags</span>
                        <button class="btn-delete" @onclick="() => RequestDeleteEntry(entry)">
                            🗑️
                        </button>
                    </div>
                </div>
            }
        </div>
    }
</div>

<Dialog IsVisible="showDeleteDialog" 
        Title="Confirm Deletion" 
        Message="@($"Are you sure you want to delete '{entryToDelete?.Title}'?")"
        ConfirmButtonText="Delete"
        CancelButtonText="Cancel"
        Type="danger" 
        OnClose="HandleDeleteResult" />