@page "/myJournals"
@using MyJournal.Components.Models
@using MyJournal.Components.Shared

<div class="page-container">
    <div class="header-section">
        <h2>My Journals</h2>
        <a href="todaysJournal" class="btn-add">
            + New Entry
        </a>
    </div>
    <div class="filter-section">
    <div class="search-box">
        <input type="text" 
               placeholder="Search Journals..." 
               @bind="searchTerm" 
               @bind:event="oninput" 
               @onkeyup="ExecuteSearch" /> 
               @* @onkeyup makes it search instantly while typing *@
    </div>

    <select class="mood-filter" @onchange="OnMoodChanged">
        <option value="All">All Moods</option>
        <option value="Happy">😊 Happy</option>
        <option value="Excited">🤩 Excited</option>
        <option value="Calm">😌 Calm</option>
        <option value="Sad">😢 Sad</option>
        <option value="Stressed">😫 Stressed</option>
        <option value="Angry">😡 Angry</option>
    </select>
</div>

    @if (JournalList == null || JournalList.Count == 0)
    {
        <div class="empty-state">
            <div class="empty-icon">📝</div>
            <h3>No entries yet</h3>
            <p>Your journal is waiting for your first story.</p>
            <a href="todaysJournal" class="btn-primary">Write Today's Entry Entry</a>
        </div>
    }
    else
    {
        <div class="journal-grid">
            @foreach (var entry in JournalList)
            {
                <div class="journal-card">
                    <div class="card-top">
                        <span class="entry-date">@entry.EntryDate.ToString("MMM dd")</span>
                        <span class="mood-emoji" title="@entry.Mood">@GetMoodEmoji(entry.Mood)</span>
                    </div>

                    <h3 class="entry-title">@entry.Title</h3>
                    <p class="entry-preview">
                        @* @(entry.Content?.Length > 100 ? entry.Content.Substring(0, 100) + "..." : entry.Content) *@
                        @((MarkupString)GetPreview(entry.Content))
                    </p>

                    <div class="card-footer">
                        <span class="tags">@entry.Tags</span>
                        <button class="btn-delete" @onclick="() => RequestDeleteEntry(entry)">
                            🗑️
                        </button>
                    </div>
                </div>
            }
        </div>
    }
</div>

<Dialog IsVisible="showDeleteDialog" 
        Title="Confirm Deletion" 
        Message="@($"Are you sure you want to delete '{entryToDelete?.Title}'?")"
        ConfirmButtonText="Delete"
        CancelButtonText="Cancel"
        Type="danger" 
        OnClose="HandleDeleteResult" />